name: Build and Upload Blog Posts to FTP
on:
  push:
    branches:
      - master-v2
jobs:
  build_and_upload:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4.2.2
      - name: Set up Bun
        uses: oven-sh/setup-bun@v2
      - name: Install dependencies with Bun
        run: bun install
      - name: Build the project
        run: bun run build
      - name: Install lftp (FTP client)
        run: sudo apt-get install -y lftp
      - name: Upload built files to FTP
        env:
          FTP_SERVER: ${{ secrets.FTP_SERVER }}
          FTP_USERNAME: ${{ secrets.FTP_USERNAME }}
          FTP_PASSWORD: ${{ secrets.FTP_PASSWORD }}
        run: |
          BUILD_DIR='./out'
          lftp -f "
          open ftp://$FTP_USERNAME:$FTP_PASSWORD@$FTP_SERVER
          cd /domains/justinnn.dev/public_html/new/blog/
          rm -r *
          quit
          "
          lftp -f "
          open ftp://$FTP_USERNAME:$FTP_PASSWORD@$FTP_SERVER
          cd /domains/justinnn.dev/public_html/new/blog/
          mirror -R $BUILD_DIR/ ./
          quit
          "
